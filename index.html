
<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>Golem Task API</title>

    <style>
      .highlight table td { padding: 5px; }
.highlight table pre { margin: 0; }
.highlight .gh {
  color: #999999;
}
.highlight .sr {
  color: #f6aa11;
}
.highlight .go {
  color: #888888;
}
.highlight .gp {
  color: #555555;
}
.highlight .gs {
}
.highlight .gu {
  color: #aaaaaa;
}
.highlight .nb {
  color: #f6aa11;
}
.highlight .cm {
  color: #75715e;
}
.highlight .cp {
  color: #75715e;
}
.highlight .c1 {
  color: #75715e;
}
.highlight .cs {
  color: #75715e;
}
.highlight .c, .highlight .cd {
  color: #75715e;
}
.highlight .err {
  color: #960050;
}
.highlight .gr {
  color: #960050;
}
.highlight .gt {
  color: #960050;
}
.highlight .gd {
  color: #49483e;
}
.highlight .gi {
  color: #49483e;
}
.highlight .ge {
  color: #49483e;
}
.highlight .kc {
  color: #66d9ef;
}
.highlight .kd {
  color: #66d9ef;
}
.highlight .kr {
  color: #66d9ef;
}
.highlight .no {
  color: #66d9ef;
}
.highlight .kt {
  color: #66d9ef;
}
.highlight .mf {
  color: #ae81ff;
}
.highlight .mh {
  color: #ae81ff;
}
.highlight .il {
  color: #ae81ff;
}
.highlight .mi {
  color: #ae81ff;
}
.highlight .mo {
  color: #ae81ff;
}
.highlight .m, .highlight .mb, .highlight .mx {
  color: #ae81ff;
}
.highlight .sc {
  color: #ae81ff;
}
.highlight .se {
  color: #ae81ff;
}
.highlight .ss {
  color: #ae81ff;
}
.highlight .sd {
  color: #e6db74;
}
.highlight .s2 {
  color: #e6db74;
}
.highlight .sb {
  color: #e6db74;
}
.highlight .sh {
  color: #e6db74;
}
.highlight .si {
  color: #e6db74;
}
.highlight .sx {
  color: #e6db74;
}
.highlight .s1 {
  color: #e6db74;
}
.highlight .s {
  color: #e6db74;
}
.highlight .na {
  color: #a6e22e;
}
.highlight .nc {
  color: #a6e22e;
}
.highlight .nd {
  color: #a6e22e;
}
.highlight .ne {
  color: #a6e22e;
}
.highlight .nf {
  color: #a6e22e;
}
.highlight .vc {
  color: #ffffff;
}
.highlight .nn {
  color: #ffffff;
}
.highlight .nl {
  color: #ffffff;
}
.highlight .ni {
  color: #ffffff;
}
.highlight .bp {
  color: #ffffff;
}
.highlight .vg {
  color: #ffffff;
}
.highlight .vi {
  color: #ffffff;
}
.highlight .nv {
  color: #ffffff;
}
.highlight .w {
  color: #ffffff;
}
.highlight {
  color: #ffffff;
}
.highlight .n, .highlight .py, .highlight .nx {
  color: #ffffff;
}
.highlight .ow {
  color: #f92672;
}
.highlight .nt {
  color: #f92672;
}
.highlight .k, .highlight .kv {
  color: #f92672;
}
.highlight .kn {
  color: #f92672;
}
.highlight .kp {
  color: #f92672;
}
.highlight .o {
  color: #f92672;
}
    </style>
    <link href="stylesheets/screen.css" rel="stylesheet" media="screen" />
    <link href="stylesheets/print.css" rel="stylesheet" media="print" />
      <script src="javascripts/all.js"></script>
  </head>

  <body class="index" data-languages="[&quot;protobuf&quot;]">
    <a href="#" id="nav-button">
      <span>
        NAV
        <img src="images/navbar.png" alt="Navbar" />
      </span>
    </a>
    <div class="toc-wrapper">
      <img src="images/logo.svg" class="logo" alt="Logo" />
        <div class="lang-selector">
              <a href="#" data-language-name="protobuf">protobuf</a>
        </div>
        <div class="search">
          <input type="text" class="search" id="input-search" placeholder="Search">
        </div>
        <ul class="search-results"></ul>
      <ul id="toc" class="toc-list-h1">
          <li>
            <a href="#task-api" class="toc-h1 toc-link" data-title="Task-api">Task-api</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#golem-application-communication-interface" class="toc-h2 toc-link" data-title="Golem - application communication interface">Golem - application communication interface</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#the-api" class="toc-h1 toc-link" data-title="The API">The API</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#requestor" class="toc-h2 toc-link" data-title="Requestor">Requestor</a>
                  </li>
                  <li>
                    <a href="#provider" class="toc-h2 toc-link" data-title="Provider">Provider</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#errors" class="toc-h1 toc-link" data-title="Errors">Errors</a>
          </li>
      </ul>
        <ul class="toc-footer">
            <li><a href='#'>Sign Up for a Developer Key</a></li>
            <li><a href='https://docs.golem.network'>Main documentation</a></li>
        </ul>
    </div>
    <div class="page-wrapper">
      <div class="dark-box"></div>
      <div class="content">
        <h1 id='task-api'>Task-api</h1><h3 id='golem-application-communication-interface'>Golem - application communication interface</h3>
<aside class="notice">This work is in it's alpha stage and under heavy development so the interface may change frequently.</aside>

<p>This repository contains the interface that the Golem compatible application should implement as well as constants used by the protocol. The interface and the constants are defined under the <code>golem_task_api/proto</code> directory in the <a href="https://developers.google.com/protocol-buffers/">Protocol Buffers</a> files.</p>

<p>This repository also contains programming language specific packages of the <code>gRPC</code> protocol which may be used for concrete implementation. This is for the ease of development of the application but it&#39;s not required to use them in the application.
If you don&#39;t see a programming language you&#39;re interested in, feel free to create an issue or even a pull request and we will add it.</p>
<h1 id='the-api'>The API</h1>
<p>The API is divided into two independent parts - <strong>requestor</strong> and <strong>provider</strong>.</p>
<h3 id='requestor'>Requestor</h3>
<blockquote>
<p>Requestor</p>
</blockquote>
<pre class="highlight proto tab-protobuf"><code><span class="kd">service</span> <span class="n">RequestorApp</span> <span class="p">{</span>
  <span class="k">rpc</span> <span class="n">CreateTask</span> <span class="p">(</span><span class="n">CreateTaskRequest</span><span class="p">)</span> <span class="k">returns</span> <span class="p">(</span><span class="n">CreateTaskReply</span><span class="p">)</span> <span class="p">{}</span>
  <span class="k">rpc</span> <span class="n">NextSubtask</span> <span class="p">(</span><span class="n">NextSubtaskRequest</span><span class="p">)</span> <span class="k">returns</span> <span class="p">(</span><span class="n">NextSubtaskReply</span><span class="p">)</span> <span class="p">{}</span>
  <span class="k">rpc</span> <span class="n">Verify</span> <span class="p">(</span><span class="n">VerifyRequest</span><span class="p">)</span> <span class="k">returns</span> <span class="p">(</span><span class="n">VerifyReply</span><span class="p">)</span> <span class="p">{}</span>
  <span class="k">rpc</span> <span class="n">DiscardSubtasks</span> <span class="p">(</span><span class="n">DiscardSubtasksRequest</span><span class="p">)</span> <span class="k">returns</span> <span class="p">(</span><span class="n">DiscardSubtasksReply</span><span class="p">)</span> <span class="p">{}</span>
  <span class="k">rpc</span> <span class="n">RunBenchmark</span> <span class="p">(</span><span class="n">RunBenchmarkRequest</span><span class="p">)</span> <span class="k">returns</span> <span class="p">(</span><span class="n">RunBenchmarkReply</span><span class="p">)</span> <span class="p">{}</span>
  <span class="k">rpc</span> <span class="n">HasPendingSubtasks</span> <span class="p">(</span><span class="n">HasPendingSubtasksRequest</span><span class="p">)</span> <span class="k">returns</span> <span class="p">(</span><span class="n">HasPendingSubtasksReply</span><span class="p">)</span> <span class="p">{}</span>

  <span class="k">rpc</span> <span class="n">Shutdown</span> <span class="p">(</span><span class="n">ShutdownRequest</span><span class="p">)</span> <span class="k">returns</span> <span class="p">(</span><span class="n">ShutdownReply</span><span class="p">)</span> <span class="p">{}</span>
<span class="p">}</span>
</code></pre>
<p>For requestor the app should implement a long running RPC service which implements the <code>RequestorApp</code> interface from the proto files. 
The app should assume it will have access to a single directory (let&#39;s call it <code>work_dir</code>). Each task will have its own separate working directory under the main <code>work_dir</code>. You can assume that for a given <code>task_id</code> the first call will always be <code>CreateTask</code> and the following directories will exist under <code>work_dir</code> and they will be empty:</p>

<ul>
<li><p><code>{task_id}</code></p></li>
<li><p><code>{task_id}/{constants.RESOURCES}</code></p></li>
<li><p><code>{task_id}/{constants.NETWORK_RESOURCES}</code></p></li>
<li><p><code>{task_id}/{constants.RESULTS}</code></p></li>
<li><p><code>{task_id}/{constants.NETWORK_RESULTS}</code></p></li>
</ul>

<hr>
<h4 id='rpc-methods'>RPC methods</h4><h4 id='createtask'><code>CreateTask</code></h4><pre class="highlight proto tab-protobuf"><code><span class="k">rpc</span> <span class="n">CreateTask</span> <span class="p">(</span><span class="n">CreateTaskRequest</span><span class="p">)</span> <span class="k">returns</span> <span class="p">(</span><span class="n">CreateTaskReply</span><span class="p">)</span> <span class="p">{}</span>

<span class="kd">message</span> <span class="nc">CreateTaskRequest</span> <span class="p">{</span>
  <span class="kt">string</span> <span class="na">task_id</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
  <span class="kt">string</span> <span class="na">task_params_json</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">message</span> <span class="nc">CreateTaskReply</span> <span class="p">{</span>
<span class="p">}</span>
</code></pre>
<ul>
<li><p>takes two arguments <code>task_id</code> and <code>task_params_json</code></p></li>
<li><p>should treat <code>{work_dir}/{task_id}</code> as the working directory for the given task</p></li>
<li><p><code>task_params_json</code> is a JSON string containing task specific parameters</p></li>
<li><p>will only be called once with given <code>task_id</code></p></li>
<li><p>can assume <code>{task_id}/{constants.RESOURCES}</code> contains all the resources provided by task creator</p></li>
</ul>

<hr>
<h4 id='nextsubtask'><code>NextSubtask</code></h4><pre class="highlight proto tab-protobuf"><code><span class="k">rpc</span> <span class="n">NextSubtask</span> <span class="p">(</span><span class="n">NextSubtaskRequest</span><span class="p">)</span> <span class="k">returns</span> <span class="p">(</span><span class="n">NextSubtaskReply</span><span class="p">)</span> <span class="p">{}</span>

<span class="kd">message</span> <span class="nc">NextSubtaskRequest</span> <span class="p">{</span>
    <span class="kt">string</span> <span class="na">task_id</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">message</span> <span class="nc">NextSubtaskReply</span> <span class="p">{</span>
  <span class="kt">string</span> <span class="na">subtask_id</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
  <span class="kt">string</span> <span class="na">subtask_params_json</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
  <span class="k">repeated</span> <span class="kt">string</span> <span class="na">resources</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
<span class="p">}</span>
</code></pre>
<ul>
<li><p>takes one argument <code>task_id</code></p></li>
<li><p>can assume <code>CreateTask</code> was called earlier with the same <code>task_id</code></p></li>
<li><p>returns <code>subtask_id</code> which has to be a string without whitespaces and slashes (<code>/</code>) but the same string cannot be returned more than once</p></li>
<li><p>also returns <code>subtask_params_json</code> which is the JSON string containing subtask specific parameters</p></li>
</ul>

<hr>
<h4 id='haspendingsubtasks'><code>HasPendingSubtasks</code></h4><pre class="highlight proto tab-protobuf"><code><span class="k">rpc</span> <span class="n">HasPendingSubtasks</span> <span class="p">(</span><span class="n">HasPendingSubtasksRequest</span><span class="p">)</span> <span class="k">returns</span> <span class="p">(</span><span class="n">HasPendingSubtasksReply</span><span class="p">)</span> <span class="p">{}</span>

<span class="kd">message</span> <span class="nc">HasPendingSubtasksRequest</span> <span class="p">{</span>
  <span class="kt">string</span> <span class="na">task_id</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">message</span> <span class="nc">HasPendingSubtasksReply</span> <span class="p">{</span>
  <span class="kt">bool</span> <span class="na">has_pending_subtasks</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>
</code></pre>
<ul>
<li><p>takes one argument <code>task_id</code></p></li>
<li><p>returns a boolean indicating whether there are any more pending subtasks waiting for computation at given moment</p></li>
<li><p>in case when it returns <code>true</code>, the next <code>NextSubtask</code> call should return successfully</p></li>
</ul>

<hr>
<h4 id='verify'><code>Verify</code></h4><pre class="highlight proto tab-protobuf"><code><span class="k">rpc</span> <span class="n">Verify</span> <span class="p">(</span><span class="n">VerifyRequest</span><span class="p">)</span> <span class="k">returns</span> <span class="p">(</span><span class="n">VerifyReply</span><span class="p">)</span> <span class="p">{}</span>

<span class="kd">message</span> <span class="nc">VerifyRequest</span> <span class="p">{</span>
  <span class="kt">string</span> <span class="na">task_id</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
  <span class="kt">string</span> <span class="na">subtask_id</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">message</span> <span class="nc">VerifyReply</span> <span class="p">{</span>
  <span class="kt">bool</span> <span class="na">success</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>
</code></pre>
<ul>
<li><p>takes two arguments, <code>task_id</code> and <code>subtask_id</code> which specify which subtask results should be verified</p></li>
<li><p>will be called with only valid <code>task_id</code> and <code>subtask_id</code> values</p></li>
<li><p>returns a boolean indicating whether results passed the verification or not</p></li>
<li><p>for successfully verified subtasks it most likely should also perform merging the partial results into the final one</p></li>
</ul>

<hr>
<h4 id='discardsubtasks'><code>DiscardSubtasks</code></h4><pre class="highlight proto tab-protobuf"><code><span class="k">rpc</span> <span class="n">DiscardSubtasks</span> <span class="p">(</span><span class="n">DiscardSubtasksRequest</span><span class="p">)</span> <span class="k">returns</span> <span class="p">(</span><span class="n">DiscardSubtasksReply</span><span class="p">)</span> <span class="p">{}</span>

<span class="kd">message</span> <span class="nc">DiscardSubtasksRequest</span> <span class="p">{</span>
  <span class="kt">string</span> <span class="na">task_id</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
  <span class="k">repeated</span> <span class="kt">string</span> <span class="na">subtask_ids</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">message</span> <span class="nc">DiscardSubtasksReply</span> <span class="p">{</span>
  <span class="k">repeated</span> <span class="kt">string</span> <span class="na">discarded_subtask_ids</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>
</code></pre>
<ul>
<li><p>takes two arguments, <code>task_id</code> and <code>subtask_ids</code></p></li>
<li><p>should discard results of given subtasks and any dependent subtasks</p></li>
<li><p>returns list of subtask IDs that have been discarded</p></li>
<li><p>in a simple case where subtasks are independent from each other it will return the same list as it received</p></li>
</ul>

<hr>
<h4 id='benchmark'><code>Benchmark</code></h4><pre class="highlight proto tab-protobuf"><code><span class="k">rpc</span> <span class="n">RunBenchmark</span> <span class="p">(</span><span class="n">RunBenchmarkRequest</span><span class="p">)</span> <span class="k">returns</span> <span class="p">(</span><span class="n">RunBenchmarkReply</span><span class="p">)</span> <span class="p">{}</span>

<span class="kd">message</span> <span class="nc">RunBenchmarkRequest</span> <span class="p">{</span>
<span class="p">}</span>

<span class="kd">message</span> <span class="nc">RunBenchmarkReply</span> <span class="p">{</span>
  <span class="kt">float</span> <span class="na">score</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>

</code></pre>
<ul>
<li><p>takes no arguments</p></li>
<li><p>returns a score which indicates how efficient the machine is for this type of tasks</p></li>
<li><p>shouldn&#39;t take much time (preferably less than a minute for medium range machines)</p></li>
</ul>

<hr>
<h4 id='shutdown'><code>Shutdown</code></h4><pre class="highlight proto tab-protobuf"><code><span class="k">rpc</span> <span class="n">Shutdown</span> <span class="p">(</span><span class="n">ShutdownRequest</span><span class="p">)</span> <span class="k">returns</span> <span class="p">(</span><span class="n">ShutdownReply</span><span class="p">)</span> <span class="p">{}</span>

<span class="kd">message</span> <span class="nc">ShutdownRequest</span> <span class="p">{</span>
<span class="p">}</span>

<span class="kd">message</span> <span class="nc">ShutdownReply</span> <span class="p">{</span>
<span class="p">}</span>

</code></pre>
<ul>
<li><p>takes no arguments</p></li>
<li><p>should gracefully terminate the service</p></li>
</ul>

<p>When the last subtask is successfully verified on the requestor&#39;s side, the <code>work_dir/task_id/constants.RESULTS</code> directory should contain all result files and nothing else.</p>

<hr>
<h3 id='provider'>Provider</h3><pre class="highlight proto tab-protobuf"><code><span class="kd">service</span> <span class="n">ProviderApp</span> <span class="p">{</span>
  <span class="k">rpc</span> <span class="n">Compute</span> <span class="p">(</span><span class="n">ComputeRequest</span><span class="p">)</span> <span class="k">returns</span> <span class="p">(</span><span class="n">ComputeReply</span><span class="p">)</span> <span class="p">{}</span>
  <span class="k">rpc</span> <span class="n">RunBenchmark</span> <span class="p">(</span><span class="n">RunBenchmarkRequest</span><span class="p">)</span> <span class="k">returns</span> <span class="p">(</span><span class="n">RunBenchmarkReply</span><span class="p">)</span> <span class="p">{}</span>
<span class="p">}</span>
</code></pre>
<p>Provider app should implement a short-lived RPC service which implements the <code>ProviderApp</code> interface from the proto files. Short-lived means that there will be only one request issued per service instance, i.e. the service should shutdown automatically after handling the first and only request.</p>
<h4 id='rpc-commands'>RPC commands</h4><h4 id='compute'><code>Compute</code></h4>
<ul>
<li><p>gets a single working directory <code>task_work_dir</code> to operate on</p></li>
<li><p>different subtasks of the same task will have the same <code>task_work_dir</code></p></li>
<li><p>takes <code>task_id</code>, <code>subtask_id</code>, <code>subtask_params_json</code> as arguments</p></li>
<li><p>can assume the <code>{task_work_dir}/{constants.NETWORK_RESOURCES}</code> directory exists</p></li>
<li><p>can assume that under <code>{task_work_dir}/{constants.NETWORK_RESOURCES}</code> are the resources specified in the corresponding <code>NextSubtask</code> call</p></li>
<li><p>returns a filepath (relative to the <code>task_work_dir</code>) of the result file which will be sent back to the requestor with unchanged name</p></li>
</ul>
<h4 id='benchmark-2'><code>Benchmark</code></h4>
<ul>
<li><p>takes no arguments</p></li>
<li><p>returns a score which indicates how efficient the machine is for this type of tasks</p></li>
<li><p>shouldn&#39;t take much time (preferably less than a minute for medium range machines)</p></li>
</ul>
<h1 id='errors'>Errors</h1>
<aside class="notice">
This error section is stored in a separate file in <code>includes/_errors.md</code>. Slate allows you to optionally separate out your docs into many files...just save them to the <code>includes</code> folder and add them to the top of your <code>index.md</code>'s frontmatter. Files are included in the order listed.
</aside>

<p>The Kittn API uses the following error codes:</p>

<table><thead>
<tr>
<th>Error Code</th>
<th>Meaning</th>
</tr>
</thead><tbody>
<tr>
<td>400</td>
<td>Bad Request -- Your request is invalid.</td>
</tr>
<tr>
<td>401</td>
<td>Unauthorized -- Your API key is wrong.</td>
</tr>
<tr>
<td>403</td>
<td>Forbidden -- The kitten requested is hidden for administrators only.</td>
</tr>
<tr>
<td>404</td>
<td>Not Found -- The specified kitten could not be found.</td>
</tr>
<tr>
<td>405</td>
<td>Method Not Allowed -- You tried to access a kitten with an invalid method.</td>
</tr>
<tr>
<td>406</td>
<td>Not Acceptable -- You requested a format that isn&#39;t json.</td>
</tr>
<tr>
<td>410</td>
<td>Gone -- The kitten requested has been removed from our servers.</td>
</tr>
<tr>
<td>418</td>
<td>I&#39;m a teapot.</td>
</tr>
<tr>
<td>429</td>
<td>Too Many Requests -- You&#39;re requesting too many kittens! Slow down!</td>
</tr>
<tr>
<td>500</td>
<td>Internal Server Error -- We had a problem with our server. Try again later.</td>
</tr>
<tr>
<td>503</td>
<td>Service Unavailable -- We&#39;re temporarily offline for maintenance. Please try again later.</td>
</tr>
</tbody></table>

      </div>
      <div class="dark-box">
          <div class="lang-selector">
                <a href="#" data-language-name="protobuf">protobuf</a>
          </div>
      </div>
    </div>
  </body>
</html>
